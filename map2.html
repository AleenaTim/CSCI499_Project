
<!-- -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Restaurant Map with Directions and Photos</title>
  <style>
    #map {
      height: 100vh;
      width: 100%;
    }
    .info-window {
      font-family: Arial, sans-serif;
      max-width: 250px;
    }
    .info-window .title {
      font-size: 16px;
      font-weight: bold;
      margin-bottom: 5px;
    }
    .info-window .rating {
      display: flex;
      align-items: center;
      font-size: 14px;
      margin-bottom: 5px;
    }
    .info-window .rating .star {
      color: #FFD700;
      margin-right: 4px;
    }
    .info-window .address, .info-window .price-level, .info-window .type {
      font-size: 14px;
      margin-bottom: 5px;
    }
    .info-window button {
      padding: 5px 10px;
      background-color: #4285f4;
      color: #fff;
      border: none;
      cursor: pointer;
      font-size: 14px;
    }
    .info-window button:hover {
      background-color: #357ae8;
    }
    .info-window img {
      width: 100%;
      height: auto;
      max-height: 150px;
      object-fit: cover;
      border-radius: 5px;
      margin-bottom: 5px;
    }
  </style>
</head>
<body>
  <div id="map"></div>
  
  <!-- Google Maps JavaScript API -->
  <script src="https://maps.googleapis.com/maps/api/js?key=API KEY &libraries=places&callback=initMap" async defer></script>
  
  <script>
    let map, userMarker, infoWindow, service, directionsService, directionsRenderer, userLocation;

    function initMap() {
      map = new google.maps.Map(document.getElementById("map"), {
        center: { lat: -33.8688, lng: 151.2093 },
        zoom: 15,
      });

      infoWindow = new google.maps.InfoWindow();
      directionsService = new google.maps.DirectionsService();
      directionsRenderer = new google.maps.DirectionsRenderer();
      directionsRenderer.setMap(map);

      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
          (position) => {
            userLocation = {
              lat: position.coords.latitude,
              lng: position.coords.longitude,
            };

            userMarker = new google.maps.Marker({
              position: userLocation,
              map,
              icon: {
                url: "http://maps.google.com/mapfiles/ms/icons/blue-dot.png",
                scaledSize: new google.maps.Size(40, 40),
              },
              title: "You are here",
            });

            map.setCenter(userLocation);
            fetchNearbyRestaurants(userLocation);
          },
          () => {
            handleLocationError(true, map.getCenter());
          }
        );
      } else {
        handleLocationError(false, map.getCenter());
      }
    }

    function handleLocationError(browserHasGeolocation, pos) {
      infoWindow.setPosition(pos);
      infoWindow.setContent(
        browserHasGeolocation
          ? "Error: The Geolocation service failed."
          : "Error: Your browser doesn't support geolocation."
      );
      infoWindow.open(map);
    }

    function fetchNearbyRestaurants(location) {
      const request = {
        location: location,
        radius: 1500,
        type: "restaurant",
      };

      service = new google.maps.places.PlacesService(map);
      service.nearbySearch(request, (results, status) => {
        if (status === google.maps.places.PlacesServiceStatus.OK) {
          results.forEach((place) => {
            createMarker(place);
          });
        }
      });
    }

    function createMarker(place) {
      const marker = new google.maps.Marker({
        map,
        position: place.geometry.location,
      });

      google.maps.event.addListener(marker, "click", () => {
        service.getDetails({ placeId: place.place_id }, (result, status) => {
          if (status === google.maps.places.PlacesServiceStatus.OK) {
            const { name, vicinity, price_level, types, rating, photos } = result;

            // Use the first photo if available
            const photoUrl = photos && photos.length > 0 ? photos[0].getUrl({ maxWidth: 250, maxHeight: 150 }) : null;

            // Build the content for the info window with an image
            let content = `
              <div class="info-window">
                ${photoUrl ? `<img src="${photoUrl}" alt="${name}">` : ""}
                <div class="title">${name}</div>
                <div class="rating"><span class="star">â˜…</span>${rating || 'N/A'}</div>
                <div class="address">Address: ${vicinity}</div>
                <div class="price-level">Price Level: ${priceLevelToText(price_level)}</div>
                <div class="type">Type: ${types.join(', ')}</div>
                <button onclick="calculateRoute(${place.geometry.location.lat()}, ${place.geometry.location.lng()})">Directions</button>
              </div>
            `;
            infoWindow.setContent(content);
            infoWindow.open(map, marker);
          }
        });
      });
    }

    function priceLevelToText(price_level) {
      switch (price_level) {
        case 0: return "Free";
        case 1: return "Low";
        case 2: return "Mid";
        case 3: return "High";
        case 4: return "Expensive";
        default: return "N/A";
      }
    }

    function calculateRoute(lat, lng) {
      if (!userLocation) {
        alert("User location not found. Unable to calculate route.");
        return;
      }

      const destination = { lat, lng };
      const request = {
        origin: userLocation,
        destination: destination,
        travelMode: google.maps.TravelMode.DRIVING,
      };

      directionsService.route(request, (result, status) => {
        if (status === google.maps.DirectionsStatus.OK) {
          directionsRenderer.setDirections(result);
        } else {
          alert("Directions request failed due to " + status);
        }
      });
    }
  </script>
</body>
</html>
